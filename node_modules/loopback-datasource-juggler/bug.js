var jdb = require('./');
var ModelBuilder = jdb.ModelBuilder;
var DataSource = jdb.DataSource;
var Memory = require('./lib/connectors/memory');
var assert = require('assert');
var ID = 'custom-generated-id';

var memory = new DataSource({connector: Memory});
var modelBuilder = memory.modelBuilder;

var BuggyModel = modelBuilder.define('BuggyModel', {
  id: {type: String, generated: true, id: true},
});
BuggyModel.getter.id = function() { return ID; };

/** test code simulating test/change.test.js **/
BuggyModel.attachTo(memory);

var ch = new BuggyModel({ id: ID });
ch.save(function(err, saved) {
  if (err) throw err;
  console.log('saved', saved);
  assert.equal(ID, saved.id);

  BuggyModel.findById(ID, function(err, found) {
    if (err) throw err;
    console.log('found', found);
    assert.equal(ID, found.id);
  });
});
